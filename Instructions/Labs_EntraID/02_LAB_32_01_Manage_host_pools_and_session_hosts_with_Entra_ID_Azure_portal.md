---
lab:
  title: '랩: Azure Portal을 사용하여 호스트 풀과 세션 호스트 배포(Entra ID)'
  module: 'Module 3.2: Plan and implement user experience and client settings'
---

# 랩 - Azure Portal을 사용하여 호스트 풀 및 세션 호스트 배포(Entra ID)
# 학생용 랩 매뉴얼

## 랩 종속성

- 이 랩에서 사용할 Azure 구독
- 이 랩에서 사용할 Azure 구독에 대한 Owner 또는 Contributor 역할, 그리고 해당 Azure 구독에 연결된 Microsoft Entra 테넌트에 디바이스를 연결하기에 충분한 사용 권한이 설정되어 있는 Entra 계정
- *Azure Portal을 사용하여 호스트 풀 및 세션 호스트 배포(Entra ID)* 랩 완료

## 예상 소요 시간

30분

## 랩 시나리오

기존 Azure Virtual Desktop 환경이 있습니다. 다양한 기능 및 비즈니스 요구 사항을 지원하려면 Microsoft Entra 조인 세션 호스트를 사용하여 호스트 풀을 구성해야 합니다. 요구 사항은 다음과 같습니다.

- 더 많은 수의 원격 사용자를 수용하기 위해 추가 세션 호스트 배포
- 호스트 풀 부하 분산 구성을 최적화하고 *연결 시 VM 시작* 기능을 활용하여 Azure Virtual Desktop 환경의 비용 최소화
- 유지 관리 기간을 구현하여 업무 시간 동안 세션 호스트의 가용성 최대화
- Microsoft Entra 조인 세션 호스트에 Single Sign-On 사용
- 유용성 및 사용자 환경 최대화(예: 연결이 끊긴 세션을 자동으로 다시 연결)

## 목표
  
이 랩을 완료하면 다음을 수행할 수 있습니다.

- 다양한 기능 및 비즈니스 요구 사항을 지원하기 위해 Microsoft Entra 조인 Azure Virtual Desktop 세션 호스트 구성

## 랩 파일

- None

## 지침

### 연습 1: Microsoft Entra 조인 세션 호스트를 포함하는 Azure Virtual Desktop 환경 관리
  
이 연습의 주요 작업은 다음과 같습니다.

1. Azure Virtual Desktop 호스트 풀 세션 호스트 추가 배포
1. 호스트 풀 속성 검토 및 구성
1. Azure Virtual Desktop 서비스 주체에 필요한 RBAC 역할 할당
1. 예약된 에이전트 업데이트 구성
1. 호스트 풀의 RDP 속성 구성

#### 작업 1: Azure Virtual Desktop 호스트 풀 세션 호스트 추가 배포

1. 필요한 경우 랩 컴퓨터에서 웹 브라우저를 시작하고 Azure Portal로 이동한 뒤, 이 랩에서 사용할 구독에서 Owner 역할이 있는 사용자 계정의 자격 증명을 입력하여 로그인합니다.

    > **참고**: 랩 세션 창 오른쪽에 있는 리소스 탭의 목록에 있는 `User1-` 계정의 자격 증명을 사용합니다.

1. Azure Portal이 표시된 웹 브라우저에서 **Azure Virtual Desktop**을 검색하여 선택한 다음, **Azure Virtual Desktop** 페이지의 세로 메뉴 모음에 있는 **관리** 섹션에서 **호스트 풀**을 선택합니다.
1. **Azure Virtual Desktop \| 호스트 풀** 페이지의 호스트 풀 목록에서 **az140-21-hp1**을 선택합니다.
1. **az140-21-hp1** 페이지의 세로 메뉴 모음에 있는 **관리** 섹션에서 **세션 호스트**를 선택하여 풀이 호스트 2개로 구성되어 있는지 확인합니다. 
1. **az140-21-hp1 \| 세션 호스트** 페이지에서 **+ 추가**를 선택합니다.
1. **호스트 풀에 가상 머신 추가** 페이지의 **기본** 탭에서 미리 구성된 설정을 검토하고 **다음: 가상 머신**을 선택합니다.
1. **호스트 풀에 가상 머신 추가** 페이지의 **가상 머신** 탭에서 다음 설정을 지정하고(다른 설정은 기본값 유지) **검토 + 만들기**를 선택합니다.

    > **참고**: **이름 접두사** 값을 설정할 때 랩 세션 창의 오른쪽에 있는 리소스 탭으로 전환하고 *User1-* 과 *@* 문자 사이의 문자열을 확인합니다. 이 문자열을 사용하여 *random* 자리 표시자를 바꿉니다.

    |설정|값|
    |---|---|
    |Resource group|**az140-21e-RG**|
    |이름 접두사|**sh**-*random*|
    |가상 머신 위치|처음 2개 세션 호스트 VM을 배포한 Azure 지역의 이름|
    |가용성 옵션|**인프라 중복 필요 없음**|
    |보안 유형|**신뢰할 수 있는 시작 가상 머신**|
    |이미지|**Windows 11 Enterprise 다중 세션, 버전 23H2 + Microsoft 365 앱 - Gen2**|
    |가상 머신 크기|**표준 DC2s_v3**|
    |VM 수|**1**|
    |OS 디스크 유형|**표준 SSD**|
    |OS 디스크 크기|**기본 크기(128GB)**|
    |부팅 진단|**관리형 스토리지 계정으로 활성화(권장)**|
    |가상 네트워크|**az140-vnet11e**|
    |서브넷|**hp1-Subnet**|
    |네트워크 보안 그룹|**기본**|
    |퍼블릭 인바운드 포트|**문제**|
    |조인할 디렉터리를 선택합니다.|**Microsoft Entra ID**|
    |Intune에 VM 등록|**No**|
    |사용자 이름|**Student**|
    |암호|랩에서 세션 호스트를 배포할 때 사용한 것과 동일한 암호 *Azure Portal(Entra ID)을 사용하여 호스트 풀 및 세션 호스트 배포* 
    |암호 확인|이전에 지정한 것과 동일한 암호|

    > **참고**: 암호는 최소 12자 이상이어야 하며 소문자, 대문자, 숫자, 특수 문자를 조합해야 합니다. 자세한 내용은 [Azure VM을 만들 때의 암호 요구 사항](https://learn.microsoft.com/en-us/azure/virtual-machines/windows/faq#what-are-the-password-requirements-when-creating-a-vm-)에 대한 정보를 참조하세요.

    > **참고**: 보시다시피 기존 풀에 세션 호스트를 추가하면서 VM 접두사와 이미지를 변경할 수 있습니다. 하지만 일반적으로는 풀의 모든 VM을 바꾸려는 경우가 아니면 접두사와 이미지를 변경하지 않는 것이 좋습니다. 

1. **호스트 풀에 가상 머신 추가** 페이지의 **검토 + 만들기** 탭에서 **만들기**를 선택합니다.

    > **참고**: 프로비전 프로세스가 완료될 때까지 기다리지 말고 다음 작업으로 넘어가세요. 프로비전 프로세스는 20분 정도 걸릴 수 있습니다. 

#### 작업 2: 호스트 풀 속성 검토 및 구성

1. 랩 컴퓨터에서 Azure Portal을 표시하는 웹 브라우저에서 **Azure Virtual Desktop**을 검색하여 선택하고, **Azure Virtual Desktop** 페이지에서 세로 탐색 메뉴의 **관리** 섹션에서 **호스트 풀**을 선택하고, **Azure Virtual Desktop \|호스트 풀** 페이지에서 **az140-21-hp1**을 선택합니다. 
1. **az140-21-hp1** 페이지의 **설정** 섹션에서 **속성**을 선택합니다.
1. **az140-21-hp1\|속성** 페이지에서 다음을 비롯한 사용 가능한 구성 옵션을 검토합니다.

    - **기본 설정 앱 그룹 유형**: 이 옵션은 호스트 풀에 대한 기본 설정 앱 그룹 유형을 **Desktop** 또는 **RemoteApp**으로 설정합니다. 최종 사용자가 호스트 풀에 RemoteApp 및 Desktop 앱을 모두 게시한 경우 피드에 선택한 앱 유형만 표시됩니다.
    - **연결 시 VM 시작** : 이 옵션을 사용하면 사용자가 할당 취소된 상태에서 호스트 풀의 개별 가상 머신을 시작할 수 있습니다.
    - **유효성 검사 환경**: 유효성 검사 호스트 풀은 프로덕션에 배포되기 전에 서비스 변경 내용을 테스트하기 위한 것입니다.
    - **부하 분산 알고리즘**: 이 옵션은 폭 우선 부하 분산과 깊이 우선 부하 분산 중에서 선택할 수 있습니다. 폭 우선 부하 분산은 호스트 풀에서 사용 가능한 모든 세션 호스트에 새 사용자 세션을 배포합니다. 깊이 우선 부하 분산은 연결 수가 가장 많지만 최대 세션 제한 임계값에 도달하지 않은 사용 가능한 세션 호스트에 새 사용자 세션을 배포합니다.

1. **az140-21-hp1\|속성** 페이지의 **부하 분산 알고리즘** 드롭다운 목록에서 **깊이 우선**을 선택합니다.
1. **최대 세션 제한** 텍스트 상자에 **8**을 입력합니다.
1. **az140-21-hp1\|속성** 페이지에서 **연결 시 VM 시작**을 **예**로 설정합니다.

    > **참고**: *연결 시 VM 시작*을 사용하면 최종 사용자가 필요할 때만 세션 호스트로 사용되는 VM(가상 머신)의 전원을 켜도록 설정하여 비용을 절감할 수 있습니다. 개인 호스트 풀의 경우 *연결 시 VM 시작*은 사용자에게 이미 할당되었거나 할당될 예정인 기존 세션 호스트 VM만 켭니다. 풀링된 호스트 풀의 경우 *연결 시 VM 시작*은 아무 옵션도 설정되지 않은 경우에만 세션 호스트 VM이 켜지고, 첫 번째 VM이 세션 제한에 도달할 때만 추가 VM이 켜집니다.

1. **az140-21-hp1\|속성** 페이지에서 **저장**을 선택합니다.

    > **참고**: *연결 시 VM 시작*을 사용하려면 Azure 구독 범위에서 *Azure Virtual Desktop* 서비스 주체에 *데스크톱 가상화 전원 켜기 기여자* RBAC(역할 기반 액세스 제어) 역할을 할당해야 합니다. 

#### 작업 3: Azure Virtual Desktop 서비스 주체에 필요한 RBAC 역할 할당

1. 랩 컴퓨터에서 Azure Portal이 표시된 웹 브라우저를 열고 Azure Cloud Shell에서 PowerShell 세션을 시작합니다.

    > **참고**: 메시지가 표시되면 **시작** 창의 **구독** 드롭다운 목록에서 이 랩에서 사용 중인 Azure 구독의 이름을 선택한 다음 **적용**을 선택합니다.

1. Azure Cloud Shell 창의 PowerShell 세션에서 다음 명령을 실행하여 이 랩에서 사용 중인 Azure 구독의 Id 속성 값을 검색하여 `$subId` 변수에 저장합니다.

    ```powershell
    $subId = (Get-AzSubscription).Id
    ```

1. 다음 명령을 실행하여 $parameters 변수를 만듭니다. 이 변수에는 RBAC 역할 정의 이름, **Azure Virtual Desktop** 서비스 주체를 나타내는 Microsoft Entra 애플리케이션, 구독 범위의 값이 포함된 해시 테이블이 저장됩니다.

    ```powershell
    $parameters = @{
        RoleDefinitionName = "Desktop Virtualization Power On Contributor"
        ApplicationId = "9cdead84-a844-4324-93f2-b2e6bb768d07"
        Scope = "/subscriptions/$subId"
    }
    ```

1. RBAC 역할 할당을 만들려면 다음 명령을 실행합니다.

    ```powershell
    New-AzRoleAssignment @parameters
    ```

1. Cloud Shell 창을 닫습니다.

#### 작업 4: 예약된 에이전트 업데이트 구성

> **참고**: 예약된 에이전트 업데이트 기능을 사용하면 Azure Virtual Desktop 에이전트, 병렬 스택 및 Geneva Monitoring 에이전트의 업데이트를 위한 최대 2개의 유지 관리 기간을 만들 수 있으므로 이러한 업데이트가 업무 시간 외에 실행됩니다. 

1. Azure Portal을 표시하는 웹 브라우저에서 **az140-21-hp1** 호스트 풀 페이지로 돌아갑니다.
1. **az140-21-hp1** 페이지에서 세로 메뉴 모음의 **설정** 섹션에서 **예약된 에이전트 업데이트** 항목을 선택하고, **az140-21-hp1\|예약된 에이전트 업데이트** 페이지에서 **예약된 에이전트 업데이트** 확인란을 선택합니다.
1. **일정** 섹션에서 **로컬 세션 호스트 표준 시간대 사용** 확인란을 선택합니다.
1. **유지 관리 기간** 섹션의 **일** 드롭다운 목록에서 **토요일**을 선택하고, **시간** 드롭다운 목록에서 **오후 11시**를 선택합니다.
1. **적용**을 선택합니다.

#### 작업 5: 호스트 풀의 RDP 속성 구성

1. Azure Portal을 표시하는 웹 브라우저에서 **az140-21-hp1** 페이지의 세로 메뉴 모음에 있는 **설정** 섹션에서 **RDP 속성** 항목을 선택합니다.
1. **az140-21-hp1\|RDP 속성** 페이지의 **연결 정보** 탭에서 다음을 포함한 사용 가능한 구성 옵션을 검토합니다.

    - **Microsoft Entra Single Sign-On**: 이 옵션은 연결에서 Microsoft Entra 인증을 활용하여 Microsoft Entra에 가입된 세션 호스트에 로그인하고 효과적으로 Single Sign-On 환경을 제공할지 여부를 결정합니다. 클라이언트 컴퓨터가 Microsoft Entra에 조인되어 있을 필요는 없습니다. 
    - **자격 증명 보안 지원 공급자**: 이 옵션은 인증을 위한 CredSSP 사용을 제어합니다. CredSSP는 클라이언트 장치에서 원격 데스크톱 세션 호스트로 사용자 자격 증명을 안전하게 전달하는 기능을 제공합니다. 그러나 해당 기능에는 Entra ID 인증에 대한 지원이 포함되지 않습니다.
    - **대체 셸**: 이 옵션을 사용하면 세션 호스트에 대한 새 연결이 설정될 때마다 시작할 실행 파일을 지정할 수 있습니다. 이 설정은 Windows Server를 실행하는 세션 호스트에만 적용됩니다.
    - **KDC 프록시 이름**: 이 옵션은 Active Directory 도메인 컨트롤러에 Kerberos 인증 트래픽을 프록시하는 기능을 제공합니다.

    > **참고**: 이러한 옵션 중 세 가지는 현재 시나리오(Active Directory 도메인 서비스가 없는 Microsoft Entra 조인 세션 호스트)에 적용할 수 없으므로 첫 번째 옵션만 구성합니다. 이 옵션은 `enablerdsaadauth:i:value` RDP 속성에 해당합니다.

1. **Microsoft Entra Single Sign-On** 드롭다운 목록에서 **연결에 Microsoft Entra 인증을 사용하여 Single Sign-On 제공** 옵션을 선택한 다음 **저장**을 선택합니다.

    > **중요**: 이 특정 RDP 속성을 활성화하는 것은 Single Sign-On 기능을 구현하는 데 필요한 여러 단계 중 하나일 뿐이라는 점을 명심해야 합니다. 이 시나리오에 적용 가능한 다른 작업으로는 Entra 테넌트에서 RDP에 대한 Microsoft Entra 인증을 활성화하고 디바이스 그룹을 구성하는 작업이 있습니다. 이러한 작업은 현재 버전의 랩 환경에서는 지원되지 않으므로 지침에 포함되지 않습니다. Microsoft Entra ID에 대한 Single Sign-On을 구현하는 데 필요한 작업의 전체 목록은 [Microsoft Entra ID 인증을 사용하여 Azure Virtual Desktop에 대한 Single Sign-On 구성](https://learn.microsoft.com/en-us/azure/virtual-desktop/configure-single-sign-on)을 참조하세요.

1. **az140-21-hp1\|RDP 속성** 페이지에서 **세션 동작** 탭을 선택하고 다음을 포함한 사용 가능한 구성 옵션을 검토합니다.

    - **다시 연결**: 이 옵션은 연결이 끊어졌을 때 클라이언트 컴퓨터가 원격 컴퓨터에 자동으로 다시 연결을 시도할지 여부를 결정합니다.
    - **대역폭 자동 검색**: 이 옵션은 자동 네트워크 대역폭 검색을 사용할지 여부를 결정합니다.
    - **네트워크 자동 검색**: 이 옵션을 사용하면 네트워크 유형을 자동으로 검색할 수 있습니다. 이 옵션은 **대역폭 자동 검색**과 함께 사용됩니다. 
    - **압축**: 이 옵션은 연결에서 대량 압축을 사용해야 하는지 여부를 결정합니다.
    - **비디오 재생**: 이 옵션을 사용하면 비디오 재생에 RDP 효율적인 멀티미디어 스트리밍을 사용할 수 있습니다.

1. **세션 동작** 탭의 **다시 연결** 드롭다운 목록에서 **클라이언트가 자동으로 다시 연결을 시도합니다**를 선택한 다음 **저장**을 선택합니다.
1. **az140-21-hp1\|RDP 속성** 페이지에서 **디바이스 리디렉션** 탭을 선택하고 두 가지 주요 범주를 포함하여 사용 가능한 구성 옵션을 검토합니다.

    - **오디오 및 동영상**
    - **로컬 디바이스 및 리소스**

    > **참고**: 리디렉션은 기본적으로 초기 연결이 설정된 후 탑재된 드라이브를 포함하여 모든 디스크 드라이브에 적용됩니다.

1. **az140-21-hp1\|RDP 속성** 페이지에서 **디스플레이 설정** 탭을 선택하고 다중 디스플레이 지원, 스마트 크기 조정, 특정 데스크톱 크기(픽셀) 등 사용 가능한 구성 옵션을 검토합니다. 
1. **az140-21-hp1\|RDP 속성** 페이지에서 **고급** 탭을 선택하고 기존 구성 설정을 검토합니다. 이 설정은 이 작업의 앞부분에서 변경한 내용을 반영합니다.
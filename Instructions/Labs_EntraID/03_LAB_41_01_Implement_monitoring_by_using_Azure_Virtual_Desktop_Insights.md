---
lab:
  title: '랩: Azure Virtual Desktop Insights를 사용하여 모니터링 구현'
  module: 'Module 4.1: Monitor and manage Azure Virtual Desktop services'
---

# 랩 - Azure Virtual Desktop Insights를 사용하여 모니터링 구현
# 학생용 랩 매뉴얼

## 랩 종속성

- 이 랩에서 사용할 Azure 구독
- 이 랩에서 사용할 Azure 구독에 대한 Owner 또는 Contributor 역할, 그리고 해당 Azure 구독에 연결된 Microsoft Entra 테넌트에 디바이스를 연결하기에 충분한 사용 권한이 설정되어 있는 Entra 계정
- *Azure Portal을 사용하여 호스트 풀 및 세션 호스트 배포(Entra ID)* 랩 완료
- *Azure Portal을 사용하여 호스트 풀 및 세션 호스트 관리(Entra ID)* 랩 완료

## 예상 소요 시간

25분

## 랩 시나리오

기존 Azure Virtual Desktop 환경이 있습니다. 이 환경의 상태 및 활동을 모니터링하려고 합니다.

## 목표
  
이 랩을 완료하면 다음을 수행할 수 있습니다.

- Azure Virtual Desktop 환경 모니터링 구현

## 랩 파일

- None

## 지침

### 연습 1: Azure Virtual Desktop 환경 모니터링 구현
  
이 연습의 주요 작업은 다음과 같습니다.

1. Microsoft.Insights 리소스 공급자에 Azure 구독 등록
1. Azure Log Analytics 작업 영역 만들기
1. Virtual Desktop Insights 구성 통합 문서 설정

#### 작업 1: Microsoft.Insights 리소스 공급자에 Azure 구독 등록

> **참고**: Azure Virtual Desktop Insights는 Microsoft.Insights 리소스 공급자를 사용하므로 먼저 이 랩에서 사용할 Azure 구독 내에 해당 공급자를 등록해야 합니다. *Azure Portal을 사용하여 호스트 풀 및 세션 호스트 배포(Entra ID)* 랩에서는 Azure PowerShell을 사용하여 이 작업을 수행했습니다. 이 랩에서는 Azure Portal을 사용하여 이 작업을 수행합니다(두 방법 모두 지원되며 사용할 수 있습니다).

1. 필요한 경우 랩 컴퓨터에서 웹 브라우저를 시작하고 Azure Portal로 이동한 뒤, 이 랩에서 사용할 구독에서 Owner 역할이 있는 사용자 계정의 자격 증명을 입력하여 로그인합니다.

    > **참고**: 랩 세션 창 오른쪽에 있는 리소스 탭의 목록에 있는 `User1-` 계정의 자격 증명을 사용합니다.

1. 랩 컴퓨터에서 Azure Portal을 표시한 웹 브라우저를 찾아 **구독**을 검색하고 선택한 뒤 **구독** 페이지에서 이 랩에서 사용하는 Azure 구독을 선택하고, 세로 탐색 메뉴의 **설정** 섹션에서 **리소스 공급자**를 선택합니다.
1. **리소스 공급자** 탭의 검색 텍스트 상자에 **Microsoft.Insights**를 입력하고 결과 목록에서 **Microsoft.Insights** 항목 왼쪽에 있는 작은 원을 선택한 다음 **등록**을 선택합니다.

    > **참고**: 등록 프로세스가 완료될 때까지 기다립니다. 보통 1분 정도 소요됩니다. **새로 고침** 도구 모음 단추를 사용하여 등록 상태의 최신 값을 표시합니다.

#### 작업 2: Azure Log Analytics 작업 영역 만들기

> **참고**: Azure Virtual Desktop Insights는 Azure Virtual Desktop 환경 모니터링을 지원하는 Azure Monitor 통합 문서 기반의 대시보드입니다. 

> **참고**: 자동 크기 조정 작업은 풀링된 호스트 풀이 있는 Insights를 통해서만 모니터링할 수 있습니다. 

1. 랩 컴퓨터에서 Azure Portal을 표시한 웹 브라우저를 찾아 **Log Analytics 작업 영역**을 검색하여 선택하고 **Log Analytics 작업 영역** 페이지에서 **+ 만들기**를 선택합니다.
1. **Log Analytics 작업 영역 만들기** 페이지의 **기본** 탭에서 다음 설정을 지정하고 **검토 + 만들기**를 선택합니다.

    |설정|값|
    |---|---|
    |구독|이 랩에서 사용 중인 Azure 구독의 이름|
    |Resource group|새 리소스 그룹의 이름 **az140-411e-RG**|
    |속성|**az140-laworkspace41e**|
    |지역|Azure Virtual Desktop 환경을 배포한 Azure 지역의 이름|

1. **검토 + 만들기** 창에서 **만들기**를 선택합니다.

    > **참고**: 프로비저닝 프로세스가 완료될 때까지 기다립니다. 보통 1분 정도 소요됩니다.

    > **참고**: 다음으로, Azure Virtual Desktop 환경의 진단, 세션 호스트의 성능 카운터 및 Azure Virtual Desktop 세션 호스트의 Windows 이벤트 로그에서 새로 프로비저닝된 Log Analytics 작업 영역에서 데이터 수집을 사용하도록 설정해야 합니다.

#### 작업 3: Virtual Desktop Insights 구성 통합 문서 설정

> **참고**: Azure Virtual Desktop Insights를 처음 여는 경우 Azure Virtual Desktop 환경을 대상으로 Azure Virtual Desktop Insights를 설정해야 합니다.

1. 랩 컴퓨터에서 Azure Portal을 표시하는 웹 브라우저에서 **Azure Virtual Desktop**을 검색하여 선택하고 **Azure Virtual Desktop** 페이지의 세로 탐색 메뉴의 **모니터링** 섹션에서, **통합 문서**를 선택합니다.
1. **Windows Virtual Desktop** 통합 문서 목록의 **Windows Virtual Desktop** 섹션에서, **Insights** 통합 문서를 선택합니다.
1. **Azure Virtual Desktop \| 통합 문서\| Insights** 페이지에서 작업 영역 및 세션 호스트가 작업 영역으로 데이터를 보내지 않음을 나타내는 경고 메시지를 검토한 다음, **통합 문서 구성** 링크를 선택하여 문제를 복구합니다.
1. **CheckAMAConfiguration** 페이지의 **리소스 진단 설정** 탭의 **Log Analytics 작업 영역** 드롭다운 목록에서 **az140-laworkspace41e**를 선택합니다.
1. **CheckAMAConfiguration** 페이지의 **리소스 진단 설정** 탭의 **호스트 풀 az140-21-hp1** 섹션에서 선택한 호스트 풀에 대한 기존 진단 구성이 없음을 나타내는 경고 메시지를 확인한 다음, **호스트 풀 구성**을 선택합니다.
1. **템플릿 배포** 창에서 **배포**를 선택합니다.

    > **참고**: 이렇게 하면 대상 Log Analytics 작업 영역에서 다음 진단 테이블을 효과적으로 사용할 수 있습니다.
    - 관리 작업
    - 피드
    - 연결
    - Errors
    - 검사점
    - HostRegistration
    - AgentHealthStatus

    > **참고**: 배포가 완료될 때까지 기다립니다. 보통 1분 정도 소요됩니다.

1. **CheckAMAConfiguration** 페이지의 **리소스 진단 설정** 탭에서 도구 모음에서 **새로 고침** 아이콘(원형 화살표)을 선택합니다.
1. **호스트 풀 az140-21-hp1** 섹션을 검토하고 **allLogs**에 대해 진단 설정이 사용하도록 설정되어 있는지 확인합니다.
1. **리소스 진단 설정** 탭에서 작업 영역 **az140-21-ws1** 섹션까지 아래로 스크롤한 다음 **작업 영역 구성**을 선택합니다.
1. **템플릿 배포** 창에서 **배포**를 선택합니다.

    > **참고**: 이렇게 하면 **allLogs**에 대한 작업 영역이 효과적으로 구성됩니다.

    > **참고**: 배포가 완료될 때까지 기다립니다. 보통 1분 정도 소요됩니다.

1. **CheckAMAConfiguration** 페이지의 **리소스 진단 설정** 탭에서 도구 모음에서 **새로 고침** 아이콘(원형 화살표)을 선택합니다.
1. **작업 영역 az140-21-ws1** 섹션을 검토하고 진단 설정이 **allLogs**에 대해 사용하도록 설정되어 있고 thre가 남아 있는 경고 메시지가 없는지 확인합니다.
1. **CheckAMAConfiguration** 페이지의 맨 위로 이동하여 **호스트 데이터 설정 선택** 탭으로 전환합니다.
1. **호스트 데이터 설정** 선택 탭의 **DCR 만들기** 섹션에 있는 **작업 영역 대상** 드롭다운 목록에서 **az140-laworkspace41e**를 선택한 다음, **데이터 수집 규칙 만들기**를 선택합니다.
1. **템플릿 배포** 창에서 **배포**를 선택합니다.

    > **참고**: 배포가 완료될 때까지 기다립니다. 보통 1분 정도 소요됩니다.

1. **CheckAMAConfiguration** 페이지에서 **호스트 데이터 설정 선택** 탭의 도구 모음에서 **새로 고침** 아이콘(원형 화살표)을 선택합니다.

    > **참고**: 계속하기 전에 새로 만든 DCR이 **DCR 만들기** 섹션의 **사용 가능한 DCR** 하위 섹션에 나열되어 있는지 확인합니다. 그렇지 않은 경우 다시 1분 동안 기다렸다가 페이지를 다시 새로 고칩니다.

1. **호스트 데이터 설정** 선택 탭의 **선택한 DCR** 드롭다운 목록에서 **microsoft-avdi-** 접두사로 시작하는 항목을 선택합니다.
1. **호스트 데이터 설정 선택** 탭의 **DCR 연결** 섹션에서 **연결 배포**를 선택합니다.
1. **템플릿 배포** 창에서 **배포**를 선택합니다.

    > **참고**: 이렇게 하면 새로 만든 DCR을 **az140-21-hp1** 호스트 풀의 세션 호스트와 효과적으로 연결됩니다.

    > **참고**: 배포가 완료될 때까지 기다립니다. 보통 1분 정도 소요됩니다.

1. **CheckAMAConfiguration** 페이지에서 **호스트 데이터 설정 선택** 탭의 도구 모음에서 **새로 고침** 아이콘(원형 화살표)을 선택합니다.
1. **호스트 데이터 설정 선택** 탭의 **Azure Monitor 확장이 누락된 세션 호스트** 섹션에서 **확장 추가**를 선택합니다.
1. **템플릿 배포** 창에서 **배포**를 선택합니다.

    > **참고**: 이렇게 하면 **az140-21-hp1** 호스트 풀의 세션 호스트에 Azure Monitor 확장이 효과적으로 설치됩니다.

    > **참고**: 배포가 완료될 때까지 기다립니다. 1분 정도 걸릴 수 있습니다.

1. **CheckAMAConfiguration** 페이지에서 **호스트 데이터 설정 선택** 탭의 도구 모음에서 **새로 고침** 아이콘(원형 화살표)을 선택합니다.
1. 오류 또는 경고 메시지가 표시되지 않는지 확인합니다. 
1. **CheckAMAConfiguration** 페이지 상단으로 이동하여 **생성된 데이터** 탭을 선택한 다음, 도구 모음에서 **새로 고침** 아이콘(원형 화살표)을 선택합니다.
1. **지난 24시간 동안의 청구 데이터**, **성능 카운터**, **이벤트**를 포함하여 수집된 데이터를 나타내는 그래프를 표시하는 섹션을 검토합니다.

    > **참고**: **지난 24시간 동안의 청구 데이터** 섹션을 사용하여 데이터 수집을 모니터링합니다. 데이터 스토리지 및 수집에 대한 Log Analytics 비용은 사용자가 부담해야 합니다.

1. Azure Portal이 표시된 웹 브라우저에서 **Azure Virtual Desktop** 페이지로 돌아가서 세로 탐색 메뉴의 **모니터링** 섹션에서 **인사이트**를 선택합니다.
1. **Azure Virtual Desktop \| Insights** 페이지에서 **개요** 탭의 내용을 검토합니다. 여기에는 **용량** 섹션, **연결 진단: 연결할 수 있는 사용자 비율**, **연결 성능: 연결 시간(새 세션)** 및 **사용률** 원격 분석이 포함됩니다. 
1. 다음으로, **Azure Virtual Desktop \| Insights** 페이지에 있는 **연결 안정성**, **연결 진단**, **연결 성능**, **사용자**, **사용률**, **클라이언트** 및 **알림**을 포함한 나머지 탭을 모두 검토합니다.

    > **참고**: 후속 랩을 완료한 후 Insights 페이지의 해당 탭을 다시 방문하여 수집된 원격 측정 데이터를 나타내는 차트를 검토해 보세요.
